'use strict';module.exports=function(request,response,rlog,callback,_env,postdata,sb,sub,esm){let _jdata=null,_index=null,_id=null,_areq=null,_machs=null,_resp=null;switch(request.method){case 'GET':_areq=request.url.split('/');_index=_areq.pop();if(/MC/.test(_index)){_id=_index;_index=_areq.pop();_resp=Array.prototype.filter.call(_env[_index],function(e){return e._id===_id})}else {_resp=_env[_index]}response.writeHeader(200,{'Content-Type':'application/json'});response.end(JSON.stringify(_resp));break;case 'POST':_jdata=JSON.parse(postdata);_index=request.url.split('/').pop();_jdata._id='MC'+Date.now().toString(35);if(typeof _env[_index]==='undefined'){_env[_index]=[]}_env[_index].push(_jdata);callback(_env);response.writeHeader(200,{'Content-Type':'application/json'});response.end(JSON.stringify(_jdata));Array.prototype.filter.call(esm,e => e.ev==='add')[0].cb(sub,_index,_jdata._id,_jdata);break;case 'DELETE':_areq=request.url.split('/');_id=_areq.pop();_index=_areq.pop();_machs=Array.prototype.filter.call(_env[_index],function(e){return e._id!==_id});_env[_index]=_machs;callback(_env);response.writeHeader(200,{'Content-Type':'application/json'});response.end(JSON.stringify({delete:true,_id:_id}));Array.prototype.filter.call(esm,function(e){return e.ev==='delete'})[0].cb(sub,_index,_id);break;case 'PUT':_areq=request.url.split('/');_id=_areq.pop();_index=_areq.pop();_machs=Array.prototype.filter.call(_env[_index],function(e){return e._id!==_id});_jdata=JSON.parse(postdata);_env[_index]=_machs;_env[_index].push(_jdata);callback(_env);response.writeHeader(200,{'Content-Type':'application/json'});response.end(JSON.stringify({update:true,_id:_id}));Array.prototype.filter.call(esm,e => e.ev==='update')[0].cb(sub,_index,_id,_jdata);break;}};