'use strict';module.exports=function(a,b,c,d,f,g,h,i,j,k,l,m){const n=require('./swRestFul');let o='',q=k;a.on('data',function(r){o+=r}),a.on('end',function(){if(c!==void 0){let r='';try{r=decodeURI(a.url)}catch(s){c.write('DECODEURI ERROR',s)}c.write(JSON.stringify({index:{_id:null}})+'\n'+JSON.stringify({time:new Date().toISOString(),'class':'INFO',type:'ROUTER',method:a.method,data:o,remote:a.connection.remoteAddress.split(':').pop(),path:r})+'\n'),f._log.push({time:new Date().toISOString(),'class':'INFO',type:'ROUTER',method:a.method,data:o,remote:a.connection.remoteAddress.split(':').pop(),path:r})}switch(!0){case /rest\//.test(a.url):n(a,b,c,d,f,o,j,k,l,m);break;case /event-source/.test(a.url):console.log('EVENT-SOURCE created',a.connection.remoteAddress,a.connection.remotePort),a.on('close',()=>{q.subscribers=q.subscribers.filter((r)=>r!==b),console.log('close',q.subscribers.length),q.subscribers.length||(console.log('SUBACTIVE FALSE'),q.subactive=!1)}),b.writeHead(200,{Connection:'keep-alive','Content-Type':'text/event-stream','Cache-Control':'no-cache'}),b.write('retry:10000\nid:'+Date.now().toString(23)+'\ndata: {"type": "new","time":'+Date.now()+'}\n\n'),q.subscribers.push(b),console.log(q.subscribers.length,'NEW SUBS'),q.subactive||(q.subactive=!0,console.log('SUBACTIVE TRUE')),j(q);break;case /json/.test(a.url):b.writeHead(200,{'Content-Type':'application/json'}),b.end(JSON.stringify([{is:'me'},{you:'also'}],null,2));break;case /\/.*/.test(a.url):'undefined'!==g[a.url.split('?')[0]]&&(b.end(g[a.url.split('?')[0]]),m.is_debug&&console.log('FILE load',a.url));;break;default:b.writeHead(404),b.end('keine Route');}})};
