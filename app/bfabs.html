<!DOCTYPE html><html><head><meta name=description content="Web Components - Sample"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=4.0,user-scalable=yes"><title>WebComp fabs</title><style>@font-face{font-family:TheSans_LT_300_;src:url(fontawesome-webfont.woff) format("woff");font-weight:400;font-style:normal}</style><template><style>.kachel{padding-left:1em;margin:.5px;width:16em;height:9em;position:relative;float:left;color:hsla(0,0%,100%,.5);font-family:TheSans_LT_300_,arial;opacity:1;overflow:hidden}.kachel:hover{opacity:.8;cursor:pointer}.status-0{background:#001f2d}.status-1{background:#d6a700}.status-2{background:#a31e4c}.status-3{background:#94a644}.status-4{background:#0e6080}.status-5{background:#8da644}.status-6{background:#0e8067}.kachel .linie{position:absolute;top:1em;font-size:70%;letter-spacing:.1em;text-transform:uppercase}.kachel .machine{position:absolute;top:2em;font-size:90%;color:hsla(0,0%,100%,.8)}.kachel .kurztext{position:absolute;top:5em;font-weight:700;color:#fff}.kachel .datetime{position:absolute;bottom:2em;font-size:70%;color:hsla(0,0%,100%,.5)}.kachel .sign{position:absolute;bottom:.5em;right:.5em;font-size:150%;color:hsla(0,0%,100%,.5)}.kachel .teilio{position:absolute;top:.1em;left:1.1em;font-size:350%;color:hsla(0,0%,100%,.9)}.kachel .teilnio{position:absolute;top:0;left:2.25em;font-size:350%;color:hsla(0,0%,100%,.9)}.kachel .row{position:absolute;bottom:.25em}.kachel .wstat{position:absolute;top:4.5em;right:2.5em}.kachel .werte{position:absolute;top:.25em;right:2.5em;width:4.5em;height:4em}.kachel .prio{position:absolute;top:-1.5em;right:-1.5em;width:3em;height:3em;background-color:#fff;transform:rotate(45deg)}.kachel .garantie{position:absolute;top:-1em;left:-1em;width:2em;height:2em;background-color:#fff;transform:rotate(25deg)}.kachel .ga{position:absolute;top:0;right:0;width:4em;height:4em}.kachel .se{position:absolute;top:0;right:0;width:.5em;height:9em}.sign-garantie::before{content:"\2611"}.sign-flag::before{content:"\F002"}.sign-ws::before{content:'\F097'}.sign-yy::before{content:'\277E'}.sparkline{fill:hsla(0,0%,100%,.3)}.statusword{fill:hsla(0,0%,100%,.8)}@media only screen and (max-width:320px){.kachel{height:5em}.kachel .kurztext{top:2.5em}.kachel .machine{top:.25em;left:5em}.kachel .linie{top:.75em}.kachel .datetime{display:none}}</style><div class="kachel status-0"><span class=teilio></span> <span class=teilnio></span> <span class=prio></span> <span class=garantie></span> <span class=linie></span> <span class=machine></span> <span class=kurztext></span> <span class=datetime></span> <span class=sign><span class=sign-ws></span> <span class=sign-garantie></span> <span class=sign-flag></span> <span class=sign-yy></span></span> <svg class=row width=15em height=10><line x1=0 y1=0 y2=0 x2=15em style="stroke-width:8px;stroke:hsla(0,0%,100%,.5)"/><line class=prozent x1=0 y1=0 y2=0 x2=0 style="stroke-width:8px;stroke:hsla(0,0%,100%,.9)"/></svg> <svg class=werte width=4.5em height=4em><line x1=0 y1=0 y2=0 x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=0 y1=0 y2=4em x2=0 style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=4.5em y1=0 y2=4em x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=0 y1=1em y2=1em x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=0 y1=2em y2=2em x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=0 y1=3em y2=3em x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><line x1=0 y1=4em y2=4em x2=4.5em style="stroke-width:1px;stroke:hsla(0,0%,100%,.2)"/><polyline class=polyline points="20,20 40,25" style="fill:none;stroke:hsla(0,0%,100%,.9);stroke-width:1px"/><g id=sparkline></g></svg> <svg class=wstat width=4em height=0.3em><rect x=0 width=4em height=0.3em style=fill:hsla(0,0%,100%,.2)></rect><g id=status></g></svg> <svg class=ga width=4em height=4em><g id=ga></g></svg> <svg class=se width=0.5em height=9em><g id=se></g></svg></div></template><script>!function(){var t=document.currentScript.ownerDocument;document.registerElement("x-kachel",{prototype:Object.create(HTMLElement.prototype,{getRecs:{value:function(t){return[9,8,7,6,5,4,3,2,1,0].reduce(function(e,s){return e+((t&1<<s)===1<<s?'<rect x="'+(60-5*s)+'"  width="4" height="4" class="statusword"></rect>':"")},"")}},createdCallback:{value:function(){var e=t.querySelector("template"),s=document.importNode(e.content,!0);this.shadow=this.createShadowRoot(),this.shadow.appendChild(s),this.shadow.querySelector(".kurztext").textContent=this.getAttribute("kurztext")||"St√∂rung allgemein",this.shadow.querySelector(".linie").textContent=this.getAttribute("linie")||"ZKH",this.shadow.querySelector(".machine").textContent=this.getAttribute("machine")||"AF100",this.shadow.querySelector(".datetime").textContent=this.getAttribute("datetime")||"2014-01-01 00:00",this.shadow.querySelector(".teilio").textContent=this.getAttribute("teilio")||"0",this.shadow.querySelector(".teilnio").textContent=this.getAttribute("teilnio")||"",this.shadow.querySelector(".prozent").setAttribute("x2",15*(this.getAttribute("prozent")||0)/100+"em"),this.shadow.querySelector(".prio").setAttribute("class",this.getAttribute("prio")||"prio-none"),this.shadow.querySelector(".garantie").setAttribute("class",this.getAttribute("garantie")||"garantie-none"),this.shadow.querySelector(".sign-ws").setAttribute("class",this.getAttribute("sign-ws")||"sign-ws"),this.shadow.querySelector(".sign-yy").setAttribute("class",this.getAttribute("sign-yy")||"sign-yy-none"),this.shadow.querySelector(".sign-flag").setAttribute("class",this.getAttribute("sign-flag")||"sign-flag-none"),this.shadow.querySelector(".sign-garantie").setAttribute("class",this.getAttribute("sign-garantie")||"sign-garantie-none"),this.shadow.querySelector(".kachel").setAttribute("class","kachel status-"+(this.getAttribute("status")||0)),this.setAttribute("werte","0"),this.setAttribute("astatus",this.getAttribute("status")||"0"),this.setAttribute("status",this.getAttribute("status")||"0"),this.setAttribute("nextvalue","0"),this.setAttribute("teilio",""),this.setAttribute("stattime",Date.now()),this.shadow.querySelector("#sparkline").innerHTML='<rect class="sparkline" y="40" width="4" height="40"/>',this.shadow.querySelector("polyline").setAttribute("points",(this.getAttribute("werte")||"0,0").split(",").reduce(function(t,e,s){return t+4*s+","+(65-e)+" "},""));var i=this;setInterval(i.barchangeticker.bind(i),2e3)}},barchangeticker:{value:function(){this.setAttribute("prozent",Math.floor((Date.now()-this.getAttribute("stattime"))/5e3));var t=this.getAttribute("astatus").split(",");t.push(this.getAttribute("status")),t.length>25&&t.shift(),this.setAttribute("astatus",t.join(",")),this.shadow.querySelector("#sparkline").innerHTML=t.reduce(function(t,e,s){return t+'<rect class="sparkline" y="'+(60-4*e)+'" x="'+3*s+'" width="3" height="'+(4+4*e)+'"></rect>'},"")}},attributeChangedCallback:{value:function(){if("prio"===arguments[0]&&this.shadow.querySelector(".prio-none").setAttribute("class",arguments[2]),"garantie"===arguments[0]&&this.shadow.querySelector(".garantie-none").setAttribute("class",arguments[2]),"kurztext"===arguments[0]&&(this.shadow.querySelector(".kurztext").textContent=arguments[2]),"linie"===arguments[0]&&(this.shadow.querySelector(".linie").textContent=arguments[2]),"machine"===arguments[0]&&(this.shadow.querySelector(".machine").textContent=arguments[2]),"prozent"===arguments[0]&&this.shadow.querySelector(".prozent").setAttribute("x2",15*arguments[2]/100+"em"),"sign-garantie"===arguments[0]&&this.shadow.querySelector(".sign-garantie").setAttribute("class",arguments[2]),"sign-ws"===arguments[0]&&this.shadow.querySelector(".sign-ws").setAttribute("class",arguments[2]),"sign-yy"===arguments[0]&&this.shadow.querySelector(".sign-yy").setAttribute("class",arguments[2]),"sign-flag"===arguments[0]&&this.shadow.querySelector(".sign-flag").setAttribute("class",arguments[2]),"status"===arguments[0]&&(this.shadow.querySelector(".kachel").setAttribute("class","kachel status-"+arguments[2]),this.setAttribute("stattime",Date.now()),this.shadow.querySelector("#status").innerHTML=this.getRecs(arguments[2]),console.log("attrchange status",this.getAttribute("status"),this.getAttribute("linie"),this.getAttribute("machine"))),"wstat"===arguments[0]&&(this.setAttribute("stattime",Date.now()),this.shadow.querySelector("#status").innerHTML=this.getRecs(arguments[2])),"ga"===arguments[0]&&(this.shadow.querySelector("#ga").innerHTML='<circle style="fill:hsla(0,0%,100%,0.6);" cx="2em" cy="2em" r="'+arguments[2]+'" >'),"se"===arguments[0]&&(this.shadow.querySelector("#se").innerHTML='<rect style="fill:hsla(0,0%,100%,0.8);" width="0.5em" height="'+arguments[2]+'em" >'),"werte"===arguments[0]&&this.shadow.querySelector("polyline").setAttribute("points",(arguments[2]||"1,1,1").split(",").reduce(function(t,e,s){return t+4*s+","+(65-e)+" "},"")),"nextvalue"===arguments[0]){var t=this.getAttribute("werte").split(",");t.push(arguments[2]),t.length>20&&t.shift(),this.setAttribute("werte",t.join(","))}"teilio"===arguments[0]&&(console.log("attrchange teilio",this.getAttribute("teilio"),this.getAttribute("linie"),this.getAttribute("machine")),this.shadow.querySelector(".teilio").textContent=this.getAttribute("teilio")),"nextio"===arguments[0]&&(this.setAttribute("teilio",(parseInt(this.getAttribute("teilio"))+parseInt(arguments[2])).toString()),this.setAttribute("nextio","0")),"astatus"===arguments[0],this.shadow.querySelector(".datetime").textContent=(new Date).toISOString()}}})})}();</script><body><script>const _table='fabs'
  const pax=(method,url,header,data)=>{return new Promise((resolve,reject)=>{var req=new XMLHttpRequest();req.open(method,url);if(header)req.setRequestHeader("Content-Type",header);req.onload=function(){if(req.status==200){resolve(req.response);}
  else{reject(Error(req.statusText));}};req.onerror=function(){reject(Error("Network Error"));};req.send((data)?JSON.stringify(data):'');});}
  pax('GET','/rest/'+_table).then((data)=>{JSON.parse(data).forEach(e=>{var elem=document.createElement('x-kachel');elem.setAttribute('id',e._id||'x');elem.setAttribute('kurztext','Taktzeit IST [s] '+(e.taktist)/10+' nio '+e.teilnio+' s '+e.lstatus+'MIN'+parseInt((e.adat-e.schichtdat)/60000));elem.setAttribute('nextvalue',e.teilio/10);elem.setAttribute('teilio',e.teilio);elem.setAttribute('linie',e.linie||'EMD.H18');elem.setAttribute('wstat',e.lstatus);elem.setAttribute('status',e.lstatus);elem.setAttribute('machine',e.arbeitsfolge||'AF x');document.body.appendChild(elem)})})
  var esource=new EventSource('/event-source'),env=[],ini=true;esource.addEventListener('update',se_update,false);function se_keep(e){var jsonData=JSON.parse(e.data);console.log('Event-Source Message: ',jsonData.type,jsonData.time,jsonData.users,jsonData.table,typeof jsonData.env,jsonData.env.length,e.lastEventId,e.origin);};function se_update(x){var e=JSON.parse(x.data);console.log('Event-Source Message: ',e.type,e.time,e.users,e.tableid,e.table,e.elem,x.lastEventId,x.origin);if(e.table===_table){const tio=e.elem.teilio
  const tsoll=e.elem.teilesoll
  const gleitschicht=(e.elem.adat-e.elem.schichtdat)/600/e.elem.schichtmin
  const gleitsoll=parseInt(gleitschicht*tsoll/100)
  const ga=Math.abs(tio-gleitsoll)
  document.getElementById(e.elem._id).setAttribute('nextvalue',e.elem.teilio/10);document.getElementById(e.elem._id).setAttribute('teilio',e.elem.teilio);document.getElementById(e.elem._id).setAttribute('wstatus',e.elem.lstatus);document.getElementById(e.elem._id).setAttribute('ga',ga/10);document.getElementById(e.elem._id).setAttribute('se',gleitschicht/100*9);document.getElementById(e.elem._id).setAttribute('status',e.elem.lstatus);document.getElementById(e.elem._id).setAttribute('kurztext','ti '+(e.elem.taktist)/10+' nio '+e.elem.teilnio+' s '+e.elem.lstatus
  +' s2e '+gleitschicht.toFixed(2)
  +' i2e '+gleitsoll
  +' ga '+(tio-gleitsoll)
  +' ga% '+((tio-gleitsoll)/(.1+gleitsoll*100)).toFixed(2));}else console.log('Event NICHT interpretiert!');};function se_add(e){var jsonData=JSON.parse(e.data);console.log('Event-Source Message: ',jsonData.type,jsonData.time,jsonData.users,jsonData.tableid,jsonData.table,jsonData.elem,e.lastEventId,e.origin);};function se_delete(e){var jsonData=JSON.parse(e.data);console.log('Event-Source Message: ',jsonData.type,jsonData.time,jsonData.users,jsonData.tableid,jsonData.table,e.lastEventId,e.origin);};function closeeventsource(){esource.close();
       }</script>
